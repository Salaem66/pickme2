<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VibeFilms</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        border: 'hsl(214.3 31.8% 91.4%)',
                        input: 'hsl(214.3 31.8% 91.4%)',
                        ring: 'hsl(222.2 84% 4.9%)',
                        background: 'hsl(0 0% 100%)',
                        foreground: 'hsl(222.2 84% 4.9%)',
                        primary: {
                            DEFAULT: 'hsl(222.2 47.4% 11.2%)',
                            foreground: 'hsl(210 40% 98%)'
                        },
                        secondary: {
                            DEFAULT: 'hsl(210 40% 96%)',
                            foreground: 'hsl(222.2 84% 4.9%)'
                        },
                        destructive: {
                            DEFAULT: 'hsl(0 84.2% 60.2%)',
                            foreground: 'hsl(210 40% 98%)'
                        },
                        muted: {
                            DEFAULT: 'hsl(210 40% 96%)',
                            foreground: 'hsl(215.4 16.3% 46.9%)'
                        },
                        accent: {
                            DEFAULT: 'hsl(210 40% 96%)',
                            foreground: 'hsl(222.2 84% 4.9%)'
                        },
                        card: {
                            DEFAULT: 'hsl(0 0% 100%)',
                            foreground: 'hsl(222.2 84% 4.9%)'
                        }
                    },
                    animation: {
                        'slide-in': 'slideIn 0.3s ease-out',
                        'slide-out': 'slideOut 0.3s ease-in',
                        'pulse-subtle': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite'
                    },
                    keyframes: {
                        slideIn: {
                            '0%': { transform: 'translateX(100%)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' }
                        },
                        slideOut: {
                            '0%': { transform: 'translateX(0)', opacity: '1' },
                            '100%': { transform: 'translateX(-100%)', opacity: '0' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .dark {
            --background: 222.2 84% 4.9%;
            --foreground: 210 40% 98%;
            --card: 222.2 84% 4.9%;
            --card-foreground: 210 40% 98%;
            --primary: 210 40% 98%;
            --primary-foreground: 222.2 84% 4.9%;
            --secondary: 217.2 32.6% 17.5%;
            --secondary-foreground: 210 40% 98%;
            --muted: 217.2 32.6% 17.5%;
            --muted-foreground: 215 20.2% 65.1%;
            --accent: 217.2 32.6% 17.5%;
            --accent-foreground: 210 40% 98%;
            --destructive: 0 62.8% 30.6%;
            --destructive-foreground: 210 40% 98%;
            --border: 217.2 32.6% 17.5%;
            --input: 217.2 32.6% 17.5%;
            --ring: 212.7 26.8% 83.9%;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-swipe {
            transition: transform 0.2s ease-out, opacity 0.2s ease-out;
        }
        
        .card-swipe.swipe-left {
            transform: translateX(-100%) rotate(-10deg);
            opacity: 0;
        }
        
        .card-swipe.swipe-right {
            transform: translateX(100%) rotate(10deg);
            opacity: 0;
        }
        
        .mood-tag {
            @apply inline-flex items-center rounded-full px-3 py-1 text-sm font-medium bg-secondary text-secondary-foreground hover:bg-accent transition-colors cursor-pointer;
        }
        
        .mood-tag:hover {
            transform: translateY(-1px);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen text-white">
    <!-- Page de recherche -->
    <div id="searchPage" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-2xl space-y-8">
            <!-- Header -->
            <div class="text-center space-y-4">
                <h1 class="text-4xl md:text-6xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                    VibeFilms
                </h1>
                <p class="text-slate-400 text-lg">Trouve le film parfait pour ton mood</p>
            </div>
            
            <!-- Search Card -->
            <div class="glass rounded-2xl p-8 space-y-6">
                <div class="space-y-4">
                    <label class="text-lg font-medium text-slate-200">Comment tu te sens aujourd'hui ?</label>
                    <div class="space-y-4">
                        <input
                            id="mainMoodInput"
                            type="text"
                            placeholder="Ex: j'ai envie de rire, quelque chose d'intense..."
                            class="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                        />
                        <div class="flex gap-3">
                            <button
                                id="searchBtn"
                                class="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-lg font-medium transition-all duration-200 hover:scale-105 text-lg"
                            >
                                üîç
                            </button>
                            <button
                                id="surpriseBtn"
                                class="flex-1 px-6 py-3 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 rounded-lg font-medium transition-all duration-200 hover:scale-105 text-lg text-white"
                            >
                                üé≤
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Mood Suggestions -->
                <div class="space-y-3">
                    <p class="text-sm text-slate-400">Ou choisis un mood :</p>
                    <div id="mainMoodTags" class="flex flex-wrap gap-2">
                        <!-- Suggestions will be loaded here -->
                    </div>
                </div>
                
                <!-- Platform Filters -->
                <div class="space-y-3">
                    <p class="text-sm text-slate-400">Mes plateformes (optionnel) :</p>
                    <div class="flex flex-wrap gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer group">
                            <input type="checkbox" id="netflix" class="platform-checkbox w-4 h-4 rounded border-slate-600 bg-slate-800 text-red-500 focus:ring-2 focus:ring-red-500">
                            <span class="text-sm group-hover:text-red-400 transition-colors">Netflix</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer group">
                            <input type="checkbox" id="amazonprime" class="platform-checkbox w-4 h-4 rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-2 focus:ring-blue-500">
                            <span class="text-sm group-hover:text-blue-400 transition-colors">Amazon Prime</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer group">
                            <input type="checkbox" id="appletv" class="platform-checkbox w-4 h-4 rounded border-slate-600 bg-slate-800 text-gray-400 focus:ring-2 focus:ring-gray-500">
                            <span class="text-sm group-hover:text-gray-300 transition-colors">Apple TV</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer group">
                            <input type="checkbox" id="disneyplus" class="platform-checkbox w-4 h-4 rounded border-slate-600 bg-slate-800 text-blue-400 focus:ring-2 focus:ring-blue-500">
                            <span class="text-sm group-hover:text-blue-300 transition-colors">Disney+</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer group">
                            <input type="checkbox" id="obs" class="platform-checkbox w-4 h-4 rounded border-slate-600 bg-slate-800 text-purple-500 focus:ring-2 focus:ring-purple-500">
                            <span class="text-sm group-hover:text-purple-400 transition-colors">OCS</span>
                        </label>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button id="clearPlatforms" class="text-xs text-slate-500 hover:text-slate-300 transition-colors">
                            ‚ùå Tout d√©cocher
                        </button>
                        <span class="text-xs text-slate-500">|</span>
                        <button id="selectAllPlatforms" class="text-xs text-slate-500 hover:text-slate-300 transition-colors">
                            ‚úÖ Tout cocher
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Page Tinder -->
    <div id="tinderPage" class="hidden min-h-screen bg-slate-900">
        <!-- Header -->
        <header class="glass fixed top-0 left-0 right-0 z-50 p-4">
            <div class="flex items-center justify-between max-w-md mx-auto">
                <button id="backBtn" class="p-2 hover:bg-white/10 rounded-full transition-colors">
                    ‚Üê
                </button>
                <h2 class="font-semibold text-lg">VibeFilms</h2>
                <div class="flex items-center space-x-2">
                    <button id="watchlistCounter" class="p-2 hover:bg-white/10 rounded-full transition-colors relative">
                        üìã
                        <span id="watchlistBadge" class="absolute -top-1 -right-1 bg-red-500 text-xs rounded-full w-5 h-5 flex items-center justify-center text-white font-bold">0</span>
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Cards Stack -->
        <div class="pt-20 pb-24 px-4">
            <div class="max-w-md mx-auto relative">
                <div id="cardStack" class="relative h-[600px]">
                    <!-- Cards will be rendered here -->
                </div>
                
                <!-- Action Buttons -->
                <div class="flex justify-center space-x-8 mt-8">
                    <button id="rejectBtn" class="w-14 h-14 bg-red-500/20 hover:bg-red-500/30 border-2 border-red-500 rounded-full flex items-center justify-center text-red-400 hover:text-red-300 transition-all duration-200 hover:scale-110">
                        ‚úï
                    </button>
                    <button id="likeBtn" class="w-14 h-14 bg-green-500/20 hover:bg-green-500/30 border-2 border-green-500 rounded-full flex items-center justify-center text-green-400 hover:text-green-300 transition-all duration-200 hover:scale-110">
                        ‚ô•
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Movie Details Modal -->
    <div id="movieModal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
        <div class="glass rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b border-white/20">
                <div class="flex items-center justify-between">
                    <h3 id="movieModalTitle" class="text-xl font-semibold">D√©tails du film</h3>
                    <button onclick="closeMovieModal()" class="p-2 hover:bg-white/10 rounded-full transition-colors">
                        ‚úï
                    </button>
                </div>
            </div>
            <div id="movieModalContent" class="overflow-y-auto max-h-[70vh]">
                <!-- Movie details will be rendered here -->
            </div>
        </div>
    </div>

    <!-- Watchlist Modal -->
    <div id="watchlistModal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
        <div class="glass rounded-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden">
            <div class="p-6 border-b border-white/20">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold">Ma Watchlist</h3>
                    <button onclick="closeWatchlist()" class="p-2 hover:bg-white/10 rounded-full transition-colors">
                        ‚úï
                    </button>
                </div>
            </div>
            <div id="watchlistContent" class="p-6 overflow-y-auto max-h-96">
                <!-- Watchlist items will be rendered here -->
            </div>
        </div>
    </div>
    
    <script>
        class ModernVibeFilms {
            constructor() {
                this.movies = [];
                this.currentIndex = 0;
                this.watchlist = JSON.parse(localStorage.getItem('vibefilms-watchlist') || '[]');
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.loadMoodSuggestions();
                this.updateWatchlistCounter();
                this.loadPlatformPreferences();
                this.setupPlatformEventListeners();
                this.showSearchPage();
            }
            
            setupEventListeners() {
                // Search functionality
                document.getElementById('searchBtn').addEventListener('click', () => this.searchMovies());
                document.getElementById('surpriseBtn').addEventListener('click', () => this.surpriseMe());
                document.getElementById('mainMoodInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.searchMovies();
                });
                
                // Tinder actions
                document.getElementById('rejectBtn').addEventListener('click', () => this.rejectMovie());
                document.getElementById('likeBtn').addEventListener('click', () => this.likeMovie());
                document.getElementById('backBtn').addEventListener('click', () => this.showSearchPage());
                document.getElementById('watchlistCounter').addEventListener('click', () => this.showWatchlist());
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowLeft') this.rejectMovie();
                    if (e.key === 'ArrowRight') this.likeMovie();
                    if (e.key === 'Escape') this.closeWatchlist();
                });
                
                this.setupMoodTags();
                this.setupPlatformEventListeners();
            }
            
            loadPlatformPreferences() {
                const savedPlatforms = JSON.parse(localStorage.getItem('vibefilms-platforms') || '[]');
                savedPlatforms.forEach(platform => {
                    const checkbox = document.getElementById(platform);
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                });
            }
            
            setupPlatformEventListeners() {
                // Event listeners pour les checkboxes
                document.querySelectorAll('.platform-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', () => this.savePlatformPreferences());
                });
                
                // Bouton "Tout d√©cocher"
                document.getElementById('clearPlatforms').addEventListener('click', () => {
                    document.querySelectorAll('.platform-checkbox').forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    this.savePlatformPreferences();
                });
                
                // Bouton "Tout cocher"
                document.getElementById('selectAllPlatforms').addEventListener('click', () => {
                    document.querySelectorAll('.platform-checkbox').forEach(checkbox => {
                        checkbox.checked = true;
                    });
                    this.savePlatformPreferences();
                });
            }
            
            getSelectedPlatforms() {
                const selected = [];
                document.querySelectorAll('.platform-checkbox:checked').forEach(checkbox => {
                    const platformName = {
                        'netflix': 'Netflix',
                        'amazonprime': 'Amazon Prime Video',
                        'appletv': 'Apple TV Plus',
                        'disneyplus': 'Disney Plus', 
                        'obs': 'OCS'
                    }[checkbox.id];
                    if (platformName) selected.push(platformName);
                });
                return selected;
            }
            
            savePlatformPreferences() {
                const selectedIds = [];
                document.querySelectorAll('.platform-checkbox:checked').forEach(checkbox => {
                    selectedIds.push(checkbox.id);
                });
                localStorage.setItem('vibefilms-platforms', JSON.stringify(selectedIds));
            }
            
            async loadMoodSuggestions() {
                try {
                    const response = await fetch('/mood-suggestions');
                    const data = await response.json();
                    const container = document.getElementById('mainMoodTags');
                    
                    container.innerHTML = data.suggestions.slice(0, 8).map(mood => 
                        `<span class="mood-tag" data-mood="${mood}">${mood}</span>`
                    ).join('');
                    
                } catch (error) {
                    console.error('Erreur suggestions:', error);
                    const defaultSuggestions = [
                        "j'ai envie de rire", "quelque chose d'intense", "une histoire d'amour", 
                        "quelque chose qui fait peur", "je me sens nostalgique", "une aventure √©pique"
                    ];
                    
                    const container = document.getElementById('mainMoodTags');
                    container.innerHTML = defaultSuggestions.map(mood => 
                        `<span class="mood-tag" data-mood="${mood}">${mood}</span>`
                    ).join('');
                }
            }
            
            setupMoodTags() {
                document.getElementById('mainMoodTags').addEventListener('click', (e) => {
                    if (e.target.classList.contains('mood-tag')) {
                        const mood = e.target.getAttribute('data-mood');
                        document.getElementById('mainMoodInput').value = mood;
                        this.searchMovies();
                    }
                });
            }
            
            async searchMovies() {
                const mood = document.getElementById('mainMoodInput').value.trim();
                if (!mood) {
                    alert('Dis-moi ton mood d\'abord ! üòä');
                    return;
                }
                
                try {
                    const selectedPlatforms = this.getSelectedPlatforms();
                    const requestBody = { mood, limit: 50 };
                    if (selectedPlatforms.length > 0) {
                        requestBody.platforms = selectedPlatforms;
                    }
                    
                    const response = await fetch('/search', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(requestBody)
                    });
                    
                    const data = await response.json();
                    
                    if (!data.results || data.results.length === 0) {
                        document.getElementById('cardStack').innerHTML = 
                            '<div class="glass rounded-2xl p-8 text-center"><h2 class="text-xl font-semibold mb-2">Aucun film trouv√©</h2><p class="text-slate-400">Essaie un autre mood !</p></div>';
                        this.showTinderPage();
                        return;
                    }
                    
                    this.movies = data.results;
                    this.currentIndex = 0;
                    this.renderCards();
                    this.showTinderPage();
                    
                } catch (error) {
                    console.error('Erreur:', error);
                    document.getElementById('cardStack').innerHTML = 
                        '<div class="glass rounded-2xl p-8 text-center"><h2 class="text-xl font-semibold mb-2 text-red-400">Erreur</h2><p class="text-slate-400">Impossible de charger les films</p></div>';
                }
            }

            async surpriseMe() {
                // Array de requ√™tes surprise pr√©d√©finies
                const surpriseQueries = [
                    "j'ai envie de rire",
                    "je veux de l'action",
                    "quelque chose de romantique",
                    "j'ai envie d'avoir peur",
                    "un film √©mouvant",
                    "de la science-fiction",
                    "une aventure √©pique",
                    "un film myst√©rieux",
                    "quelque chose de nostalgique",
                    "un film familial",
                    "j'ai envie de pleurer",
                    "quelque chose d'inspirant"
                ];

                // Choisir une requ√™te au hasard
                const randomQuery = surpriseQueries[Math.floor(Math.random() * surpriseQueries.length)];

                // Mettre √† jour l'input avec la requ√™te choisie
                document.getElementById('mainMoodInput').value = randomQuery;

                try {
                    const response = await fetch('/api/search', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            query: randomQuery,
                            limit: 50,
                            platforms: [],
                            threshold: 0.1
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const data = await response.json();

                    if (data.results && data.results.length > 0) {
                        this.movies = data.results;
                        this.currentIndex = 0;
                        this.showTinderPage();
                        this.renderCard();

                        // Notification sp√©ciale pour "Surprise"
                        this.showNotification(`üé≤ Surprise! Films pour: "${randomQuery}"`);
                    } else {
                        document.getElementById('cardStack').innerHTML =
                            '<div class="glass rounded-2xl p-8 text-center"><h2 class="text-xl font-semibold mb-2 text-red-400">Aucun film trouv√©</h2><p class="text-slate-400">Essayez une autre recherche</p></div>';
                    }
                } catch (error) {
                    console.error('Surprise search error:', error);
                    document.getElementById('cardStack').innerHTML =
                        '<div class="glass rounded-2xl p-8 text-center"><h2 class="text-xl font-semibold mb-2 text-red-400">Erreur</h2><p class="text-slate-400">Impossible de charger les films</p></div>';
                }
            }

            showSearchPage() {
                document.getElementById('searchPage').style.display = 'flex';
                document.getElementById('tinderPage').style.display = 'none';
                document.getElementById('mainMoodInput').value = '';
            }
            
            showTinderPage() {
                document.getElementById('searchPage').style.display = 'none';
                document.getElementById('tinderPage').style.display = 'block';
            }
            
            renderCards() {
                const stack = document.getElementById('cardStack');
                stack.innerHTML = '';
                
                // Show 3 cards max (current + 2 next)
                for (let i = 0; i < Math.min(3, this.movies.length - this.currentIndex); i++) {
                    const movieIndex = this.currentIndex + i;
                    const movie = this.movies[movieIndex].movie;
                    const score = this.movies[movieIndex].score;
                    
                    const card = this.createMovieCard(movie, score, i);
                    stack.appendChild(card);
                }
            }
            
            createMovieCard(movie, score, stackIndex) {
                const card = document.createElement('div');
                card.className = `card-swipe absolute inset-0 glass rounded-2xl overflow-hidden cursor-pointer`;
                card.style.zIndex = 10 - stackIndex;
                card.style.transform = `scale(${1 - stackIndex * 0.02}) translateY(${stackIndex * 4}px)`;
                
                const posterUrl = movie.poster_path || '/static/placeholder-poster.svg';
                const platforms = movie.watch_providers?.streaming || [];
                const genres = movie.genres || [];
                
                card.innerHTML = `
                    <div class="h-full flex flex-col">
                        <div class="flex-1 relative" onclick="app.showMovieDetails(${movie.id})">
                            <img src="${posterUrl}" alt="${movie.title}" 
                                 class="w-full h-80 object-cover transition-transform hover:scale-105"
                                 onerror="this.src='/static/placeholder-poster.svg'">
                            <div class="absolute top-4 right-4">
                                <div class="bg-black/60 px-2 py-1 rounded-full text-sm font-medium">
                                    ${Math.round(score * 100)}% match
                                </div>
                            </div>
                            <div class="absolute bottom-4 left-4 right-4">
                                <div class="bg-gradient-to-t from-black/80 to-transparent p-4 rounded-lg">
                                    <p class="text-xs text-white/80">üëÜ Clique pour plus d'infos</p>
                                </div>
                            </div>
                        </div>
                        <div class="p-6 space-y-4" onclick="app.showMovieDetails(${movie.id})">
                            <div>
                                <h3 class="text-xl font-bold mb-2 hover:text-purple-300 transition-colors">${movie.title}</h3>
                                <div class="flex items-center space-x-4 text-sm text-slate-400 mb-3">
                                    <span>‚≠ê ${movie.vote_average.toFixed(1)}</span>
                                    <span>${movie.release_date.split('-')[0]}</span>
                                    <span>${movie.runtime || '?'}min</span>
                                </div>
                            </div>
                            
                            <div class="space-y-2">
                                <div class="flex flex-wrap gap-1">
                                    ${genres.slice(0, 3).map(genre => 
                                        `<span class="px-2 py-1 bg-slate-700/50 rounded-full text-xs">${genre}</span>`
                                    ).join('')}
                                </div>
                                
                                ${platforms.length > 0 ? `
                                <div class="flex flex-wrap gap-1">
                                    ${platforms.slice(0, 3).map(platform => 
                                        `<span class="px-2 py-1 bg-purple-600/20 text-purple-300 rounded-full text-xs">${platform}</span>`
                                    ).join('')}
                                    ${platforms.length > 3 ? `<span class="px-2 py-1 bg-purple-600/20 text-purple-300 rounded-full text-xs">+${platforms.length - 3}</span>` : ''}
                                </div>
                                ` : ''}
                            </div>
                            
                            <p class="text-sm text-slate-300 line-clamp-3">${movie.overview}</p>
                            <div class="text-center pt-2">
                                <p class="text-xs text-purple-300">üìú Voir plus d'infos</p>
                            </div>
                        </div>
                    </div>
                `;
                
                return card;
            }
            
            rejectMovie() {
                if (this.currentIndex >= this.movies.length) return;
                
                const topCard = document.querySelector('.card-swipe');
                if (topCard) {
                    topCard.classList.add('swipe-left');
                    setTimeout(() => {
                        this.currentIndex++;
                        this.checkForMoreMovies();
                    }, 200);
                }
            }
            
            likeMovie() {
                if (this.currentIndex >= this.movies.length) return;
                
                const movie = this.movies[this.currentIndex].movie;
                this.addToWatchlist(movie);
                
                const topCard = document.querySelector('.card-swipe');
                if (topCard) {
                    topCard.classList.add('swipe-right');
                    setTimeout(() => {
                        this.currentIndex++;
                        this.checkForMoreMovies();
                    }, 200);
                }
            }
            
            checkForMoreMovies() {
                if (this.currentIndex >= this.movies.length) {
                    document.getElementById('cardStack').innerHTML = `
                        <div class="glass rounded-2xl p-8 text-center space-y-4">
                            <h2 class="text-2xl font-bold">C'est tout ! üé¨</h2>
                            <p class="text-slate-400">Tu as vu tous les films pour ce mood</p>
                            <button onclick="app.showSearchPage()" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl font-medium hover:from-purple-700 hover:to-pink-700 transition-all">
                                Nouvelle recherche
                            </button>
                        </div>
                    `;
                } else {
                    this.renderCards();
                }
            }
            
            addToWatchlist(movie) {
                if (!this.watchlist.find(m => m.id === movie.id)) {
                    this.watchlist.push(movie);
                    localStorage.setItem('vibefilms-watchlist', JSON.stringify(this.watchlist));
                    this.updateWatchlistCounter();
                }
            }
            
            removeFromWatchlist(movieId) {
                this.watchlist = this.watchlist.filter(m => m.id !== movieId);
                localStorage.setItem('vibefilms-watchlist', JSON.stringify(this.watchlist));
                this.updateWatchlistCounter();
                this.showWatchlist();
            }
            
            updateWatchlistCounter() {
                document.getElementById('watchlistBadge').textContent = this.watchlist.length;
            }
            
            showWatchlist() {
                const modal = document.getElementById('watchlistModal');
                const content = document.getElementById('watchlistContent');
                
                if (this.watchlist.length === 0) {
                    content.innerHTML = '<div class="text-center text-slate-400"><p>Aucun film dans ta watchlist</p><p class="text-sm mt-2">Swipe vers la droite pour ajouter des films !</p></div>';
                } else {
                    content.innerHTML = this.watchlist.map(movie => `
                        <div class="flex items-center space-x-4 p-4 glass rounded-xl mb-3">
                            <img src="${movie.poster_path || '/static/placeholder-poster.svg'}" 
                                 alt="${movie.title}" class="w-16 h-20 object-cover rounded-lg"
                                 onerror="this.src='/static/placeholder-poster.svg'">
                            <div class="flex-1">
                                <h4 class="font-semibold">${movie.title}</h4>
                                <p class="text-sm text-slate-400">${movie.release_date.split('-')[0]} ‚Ä¢ ‚≠ê ${movie.vote_average.toFixed(1)}</p>
                            </div>
                            <button onclick="app.removeFromWatchlist(${movie.id})" 
                                    class="p-2 text-red-400 hover:bg-red-500/20 rounded-full transition-colors">
                                ‚úï
                            </button>
                        </div>
                    `).join('');
                }
                
                modal.classList.remove('hidden');
            }
            
            closeWatchlist() {
                document.getElementById('watchlistModal').classList.add('hidden');
            }
            
            showMovieDetails(movieId) {
                // Trouver le film dans la liste actuelle
                const movieResult = this.movies.find(m => m.movie.id === movieId);
                if (!movieResult) return;
                
                const movie = movieResult.movie;
                const score = movieResult.score;
                
                const modal = document.getElementById('movieModal');
                const title = document.getElementById('movieModalTitle');
                const content = document.getElementById('movieModalContent');
                
                title.textContent = movie.title;
                
                const posterUrl = movie.poster_path || '/static/placeholder-poster.svg';
                const platforms = movie.watch_providers?.streaming || [];
                const rentPlatforms = movie.watch_providers?.rent || [];
                const buyPlatforms = movie.watch_providers?.buy || [];
                const genres = movie.genres || [];
                
                content.innerHTML = `
                    <div class="flex flex-col md:flex-row gap-6 p-6">
                        <!-- Poster -->
                        <div class="md:w-1/3">
                            <img src="${posterUrl}" alt="${movie.title}" 
                                 class="w-full rounded-2xl shadow-2xl"
                                 onerror="this.src='/static/placeholder-poster.svg'">
                        </div>
                        
                        <!-- D√©tails -->
                        <div class="md:w-2/3 space-y-6">
                            <!-- Header -->
                            <div class="space-y-4">
                                <div class="flex items-center space-x-4">
                                    <div class="bg-gradient-to-r from-purple-600 to-pink-600 px-3 py-1 rounded-full text-sm font-medium">
                                        ${Math.round(score * 100)}% match
                                    </div>
                                    <span class="text-2xl">‚≠ê ${movie.vote_average.toFixed(1)}</span>
                                </div>
                                
                                <div class="flex flex-wrap items-center gap-4 text-slate-400">
                                    <span class="text-lg">${movie.release_date.split('-')[0]}</span>
                                    <span>${movie.runtime || '?'} min</span>
                                    ${movie.original_language ? `<span>${movie.original_language.toUpperCase()}</span>` : ''}
                                </div>
                            </div>
                            
                            <!-- Genres -->
                            <div class="space-y-2">
                                <h4 class="text-lg font-semibold text-purple-300">Genres</h4>
                                <div class="flex flex-wrap gap-2">
                                    ${genres.map(genre => 
                                        `<span class="px-3 py-1 bg-slate-700/50 rounded-full text-sm">${genre}</span>`
                                    ).join('')}
                                </div>
                            </div>
                            
                            <!-- Synopsis -->
                            <div class="space-y-3">
                                <h4 class="text-lg font-semibold text-purple-300">Synopsis</h4>
                                <p class="text-slate-300 leading-relaxed">${movie.overview || 'Aucun synopsis disponible.'}</p>
                            </div>
                            
                            <!-- Plateformes -->
                            <div class="space-y-4">
                                <h4 class="text-lg font-semibold text-purple-300">O√π regarder</h4>
                                
                                ${platforms.length > 0 ? `
                                <div class="space-y-2">
                                    <h5 class="text-sm font-medium text-green-400">üé¨ Streaming</h5>
                                    <div class="flex flex-wrap gap-2">
                                        ${platforms.map(platform => 
                                            `<span class="px-3 py-2 bg-green-600/20 text-green-300 rounded-lg text-sm font-medium">${platform}</span>`
                                        ).join('')}
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${rentPlatforms.length > 0 ? `
                                <div class="space-y-2">
                                    <h5 class="text-sm font-medium text-blue-400">üí∞ Location</h5>
                                    <div class="flex flex-wrap gap-2">
                                        ${rentPlatforms.slice(0, 6).map(platform => 
                                            `<span class="px-3 py-2 bg-blue-600/20 text-blue-300 rounded-lg text-sm">${platform}</span>`
                                        ).join('')}
                                        ${rentPlatforms.length > 6 ? `<span class="px-3 py-2 bg-blue-600/20 text-blue-300 rounded-lg text-sm">+${rentPlatforms.length - 6}</span>` : ''}
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${buyPlatforms.length > 0 ? `
                                <div class="space-y-2">
                                    <h5 class="text-sm font-medium text-yellow-400">üõí Achat</h5>
                                    <div class="flex flex-wrap gap-2">
                                        ${buyPlatforms.slice(0, 6).map(platform => 
                                            `<span class="px-3 py-2 bg-yellow-600/20 text-yellow-300 rounded-lg text-sm">${platform}</span>`
                                        ).join('')}
                                        ${buyPlatforms.length > 6 ? `<span class="px-3 py-2 bg-yellow-600/20 text-yellow-300 rounded-lg text-sm">+${buyPlatforms.length - 6}</span>` : ''}
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${platforms.length === 0 && rentPlatforms.length === 0 && buyPlatforms.length === 0 ? 
                                    '<p class="text-slate-400">Aucune plateforme disponible trouv√©e.</p>' : ''}
                            </div>
                            
                            <!-- Actions -->
                            <div class="flex gap-4 pt-4">
                                <button onclick="app.addToWatchlistFromModal(${movie.id})" 
                                        class="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl font-medium hover:from-purple-700 hover:to-pink-700 transition-all">
                                    ‚ûï Ajouter √† ma watchlist
                                </button>
                                <button onclick="closeMovieModal()" 
                                        class="px-6 py-3 bg-slate-700 hover:bg-slate-600 rounded-xl font-medium transition-colors">
                                    Fermer
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                modal.classList.remove('hidden');
            }
            
            addToWatchlistFromModal(movieId) {
                const movieResult = this.movies.find(m => m.movie.id === movieId);
                if (movieResult) {
                    this.addToWatchlist(movieResult.movie);
                    this.closeMovieModal();
                }
            }
            
            closeMovieModal() {
                document.getElementById('movieModal').classList.add('hidden');
            }
        }
        
        // Global functions for onclick handlers
        function closeWatchlist() {
            app.closeWatchlist();
        }
        
        function closeMovieModal() {
            app.closeMovieModal();
        }
        
        // Initialize app
        const app = new ModernVibeFilms();
    </script>
</body>
</html>